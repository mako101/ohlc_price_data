# Python Assignment

An API server to process crypto pair position CSV data and store it in a database. 

Built with FastAPI, PySpark, MySQL and Docker.


## Installation and Setup

Clone the project.

```bash
git clone git@github.com:mako101/ohlc_price_data.git
```

Change to the repository's root directory
```bash
cd ohlc_price_data
```

Start the database and API containers via `docker-compose`

```bash
docker-compose up
```


## Using the API

### Upload the CSV Data

Example Request:

```shell
curl -X 'POST'  'http://localhost:5000/data/'  -H 'accept: application/json'  -H 'Content-Type: multipart/form-data'  -F 'file=@sample_data.csv;type=text/csv'
```
Example Request:

```json
{
  "result":"success",
  "detail":"Processed 5 entries from sample_data.csv"
}
```

### Get Records

Example Request:
```bash
curl -X 'GET' \
  'http://localhost:5000/data?symbol=BTCUSDT&start_date=2022-02-13%2002%3A30%3A00&end_date=2022-02-13%2002%3A36%3A00&limit=5&page=1' \
  -H 'accept: application/json'
```

Example Response:
```json
{
  "data": [
    {
      "open_price": 42123.29,
      "id": 1,
      "lowest": 42120.82,
      "timestamp": "2022-02-13T02:35:00",
      "symbol": "BTCUSDT",
      "highest": 42148.32,
      "close_price": 42146.06
    },
...
        ],
  "pagination": {
    "count": 5,
    "page": 1,
    "limit": 5,
    "pages": 8
  }
}
```

Query parameters:
- `symbol`: Crypto pair symbol, eg `BTCUSDT`
- `start_date`: Start date to query position data, in the format `YYYY-MM-DD hh:mm:ss`
- `end_date`: End date to query position data, in the format `YYYY-MM-DD hh:mm:ss`
- `limit`: number of records per page, default: `5`
- `page`:  page number, default: `1`.



### Web UI

In addition to the requested URLs, an autogenerated interactive API documentation / basic Web UI is available for convenience 

```
http://localhost:5000/docs#/
```



## Running Unit Tests

Install test requirements

```shell
pip install -r requirements-dev.txt
```

Run the tests
```shell
python -m unittest tests/test_unittests.py
```

## Selected Packages and Rationale
- FastAPI: high-performance, easy to use API library, with an added bonus of auto-generated Web UI / documentation
- SQLAlchemy: Python SQL toolkit and Object Relational Mapper. Makes it easy to use any supported DB backend with minimal changes to the code
- PySpark: Python API for Apache Spark, analytical processing engine for large scale powerful distributed data processing

